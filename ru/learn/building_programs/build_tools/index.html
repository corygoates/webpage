
<!DOCTYPE html>

<html lang="ru">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />
    <link rel="icon" sizes="256x256" href="../../../_static/images/favicon.ico" type="image/x-icon">
    <title>Инструменты сборки &#8212; Fortran Programming Language</title>
<script>
  document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
  document.documentElement.dataset.theme = localStorage.getItem("theme") || "light"
</script>

  <!-- Loaded before other Sphinx assets -->
  <link href="../../../_static/styles/theme.css?digest=92025949c220c2e29695" rel="stylesheet">
<link href="../../../_static/styles/pydata-sphinx-theme.css?digest=92025949c220c2e29695" rel="stylesheet">


  <link rel="stylesheet"
    href="../../../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/custom.css" />

  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../../_static/scripts/pydata-sphinx-theme.js?digest=92025949c220c2e29695">

    <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
    <script src="../../../_static/jquery.js"></script>
    <script src="../../../_static/underscore.js"></script>
    <script src="../../../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../../../_static/doctools.js"></script>
    <script src="../../../_static/sphinx_highlight.js"></script>
    <script src="../../../_static/clipboard.min.js"></script>
    <script src="../../../_static/copybutton.js"></script>
    <script src="../../../_static/translations.js"></script>
    <script src="../../../_static/design-tabs.js"></script>
    <link rel="canonical" href="https://fortran-lang.org/en/learn/building_programs/build_tools.html" />
    <link rel="index" title="Алфавитный указатель" href="../../../genindex/" />
    <link rel="search" title="Поиск" href="../../../search/" />
    <link rel="next" title="Введение в систему сборки make" href="../project_make/" />
    <link rel="prev" title="Управление библиотеками (статические и динамические библиотеки)" href="../managing_libraries/" />

<meta
  name="description"
  content="Fortran : High-performance parallel programming language"
/>
<meta
  name="keywords"
  content="High-performance, parallel, programming language"
/>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
<script type="text/javascript">
  var pr_number = -1;
  $(document).ready(function () {
    if (window.location.href.indexOf("/pr/") > -1) {
      pr_number = window.location.href.split("/").indexOf("pr") + 1;
      document.getElementById("pr").innerHTML =
        "pull request " + window.location.href.split("/")[pr_number];
      document.getElementById("pr").href =
        "https://github.com/fortran-lang/webpage/pull/" +
        window.location.href.split("/")[pr_number];
      var banner = document.getElementById("banner");
      banner.style.display = "block";
    }
  });
</script>
<div id="banner" style="display: none" class="container">
  <h3>
    <svg
      xmlns="http://www.w3.org/2000/svg"
      width="24"
      height="24"
      viewBox="0 0 24 24"
      fill="none"
      stroke="currentColor"
      stroke-width="2"
      stroke-linecap="round"
      stroke-linejoin="round"
      class="feather feather-git-pull-request"
    >
      <circle cx="18" cy="18" r="3"></circle>
      <circle cx="6" cy="6" r="3"></circle>
      <path d="M13 6h3a2 2 0 0 1 2 2v7"></path>
      <line x1="6" y1="9" x2="6" y2="21"></line>
    </svg>
    <b>Site preview: </b>you are previewing unpublished changes for
    <a id="pr"></a>
  </h3>
</div>

<link
  rel="alternate"
  type="application/atom+xml"
  href="../../../news/atom.xml"
  title="Blog"
/>


<link href="True" rel="stylesheet"/>


  </head>
  
  
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="180" data-default-mode="">
    <div class="bd-header-announcement container-fluid" id="banner">
      

    </div>

    
    <nav class="bd-header navbar navbar-light navbar-expand-lg bg-light fixed-top bd-navbar" id="navbar-main"><div class="bd-header__inner container-xl">

  <div id="navbar-start">
    
    
  


<a class="navbar-brand logo" href="../../../">
  
  
  
  
    <img src="../../../_static/fortran-logo-256x256.png" class="logo__image only-light" alt="Logo image">
    <img src="../../../_static/fortran-logo-256x256.png" class="logo__image only-dark" alt="Logo image">
  
  
</a>
    
    <span id="theme-switch" class="btn btn-sm btn-outline-primary navbar-btn rounded-circle">
    <a class="theme-switch" data-mode="light"><i class="fas fa-sun"></i></a>
    <a class="theme-switch" data-mode="dark"><i class="far fa-moon"></i></a>
    <a class="theme-switch" data-mode="auto"><i class="fas fa-adjust"></i></a>
</span>
    
    <div class="dropdown" id="version_switcher">
  <button
    type="button"
    class="btn btn-sm navbar-btn dropdown-toggle"
    id="version_switcher_button"
    data-toggle="dropdown"
  >
    ru
    <!-- this text may get changed later by javascript -->
    <span class="caret"></span>
  </button>
  <div
    id="version_switcher_menu"
    class="dropdown-menu list-group-flush py-0"
    aria-labelledby="version_switcher_button"
  >
    <!-- dropdown will be populated by javascript on page load -->
  </div>
</div>

<!-- NOTE: this JS must live here (not in our global JS file) because it relies
     on being processed by Jinja before it is run (specifically for replacing
     variables learn/building_programs/build_tools and {'json_url': 'https://fortran-lang.org/', 'version_match': 'ru'}.
-->

<script type="text/javascript">
  // Check if corresponding page path exists in other version of docs
  // and, if so, go there instead of the homepage of the other docs version
  function checkPageExistsAndRedirect(event) {
    const currentFilePath = "learn/building_programs/build_tools",
      tryUrl = event.target.getAttribute("href");
    location.href = tryUrl;
    // this prevents the browser from following the href of the clicked node
    // (which is fine because this function takes care of redirecting)
    return false;
  }

  // Populate the version switcher from the JSON config file
  (function () {
    const currentFilePath = "learn/building_programs/build_tools";
    const indexFilePath = "../../../";
    let btn = document.getElementById("version_switcher_button");
    // Set empty strings by default so that these attributes exist and can be used in CSS selectors
    btn.dataset["activeVersionName"] = "";
    btn.dataset["activeVersion"] = "";
    // create links to the corresponding page in the other docs versions
    data = [
      {
        name: "English",
        version: "en",
        url: "",
      },
      {
        name: "bn",
        version: "bn",
        url: "bn/",
      },
      {
        name: "cs",
        version: "cs",
        url: "cs/",
      },
      {
        name: "Deutsch",
        version: "de",
        url: "de/",
      },
      {
        name: "Español",
        version: "es",
        url: "es/",
      },
      {
        name: "Français",
        version: "fr",
        url: "fr/",
      },
      {
        name: "ja",
        version: "ja",
        url: "ja/",
      },
      {
        name: "Nederlands",
        version: "nl",
        url: "nl/",
      },
      {
        name: "pl",
        version: "pl",
        url: "pl/",
      },
      {
        name: "Português",
        version: "pt",
        url: "pt/",
      },
      {
        name: "Русский",
        version: "ru",
        url: "ru/",
      },
      {
        name: "简体中文",
        version: "zh_CN",
        url: "zh_CN/",
      },
    ];
    // console.log(data);
    $.each(data, function (index, entry) {
      // if no custom name specified (e.g., "latest"), use version string
      if (!("name" in entry)) {
        entry.name = entry.version;
      }
      // create the node
      const node = document.createElement("a");
      node.setAttribute("class", "list-group-item list-group-item-action py-1");
      node.textContent = `${entry.name}`;


      node.setAttribute(
        "href",
        `https://fortran-lang.org/${entry.url}${currentFilePath}`,
      );

      // on click, AJAX calls will check if the linked page exists before
      // trying to redirect, and if not, will redirect to the homepage
      // for that version of the docs.
      node.onclick = checkPageExistsAndRedirect;
      // Add dataset values for the version and name in case people want
      // to apply CSS styling based on this information.
      node.dataset["versionName"] = entry.name;
      node.dataset["version"] = entry.version;

      $("#version_switcher_menu").append(node);
      // replace dropdown button text with the preferred display name of
      // this version, rather than using sphinx's  variable.
      // also highlight the dropdown entry for the currently-viewed
      // version's entry
      if (entry.version == "ru") {
        node.classList.add("active");
        btn.innerText = btn.dataset["activeVersionName"] = entry.name;
        btn.dataset["activeVersion"] = entry.version;
      }
    });
  })();
</script>
    
  </div>

  <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-collapsible" aria-controls="navbar-collapsible" aria-expanded="false" aria-label="Toggle navigation">
    <span class="fas fa-bars"></span>
  </button>

  
  <div id="navbar-collapsible" class=" collapse navbar-collapse">
    <div id="navbar-center" class="ml-auto">
      
      <div class="navbar-center-item">
        <ul id="navbar-main-elements" class="navbar-nav">
    <li class="toctree-l1 nav-item">
 <a class="reference external nav-link" href="https://play.fortran-lang.org/">
  Play
 </a>
</li>

<li class="toctree-l1 current active nav-item">
 <a class="reference internal nav-link" href="../../">
  Обучение
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../../../roadmap/">
  Roadmap
  <!-- omit in toc -->
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../../../compilers/">
  Компиляторы
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../../../community/">
  Community
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../../../packages/">
  Packages
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../../../news/">
  News
 </a>
</li>

    
</ul>
      </div>
      
    </div>

    <div id="navbar-end">
      
      <div class="navbar-end-item">
        <ul id="navbar-icon-links" class="navbar-nav" aria-label="Icon Links">
        <li class="nav-item">
          <a class="nav-link" href="https://fortran-lang.discourse.group/" rel="noopener" target="_blank" title="Discourse"><span><i class="fab fa-discourse"></i></span>
            <label class="sr-only">Discourse</label></a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="https://twitter.com/fortranlang" rel="noopener" target="_blank" title="Twitter"><span><i class="fab fa-twitter"></i></span>
            <label class="sr-only">Twitter</label></a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="https://github.com/fortran-lang" rel="noopener" target="_blank" title="GitHub"><span><i class="fab fa-github"></i></span>
            <label class="sr-only">GitHub</label></a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="https://fortran-lang.org/en/news/atom.xml" rel="noopener" target="_blank" title="RSS"><span><i class="fas fa-rss"></i></span>
            <label class="sr-only">RSS</label></a>
        </li>
      </ul>
      </div>
      
      <div class="navbar-end-item">
        <form class="bd-search d-flex align-items-center" action="../../../search/" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Поиск" aria-label="Search" autocomplete="off" >
</form>
      </div>
      
    </div>
  </div>
</div>
    </nav>
    

    <div class="bd-container container-xl">
      <div class="bd-container__inner row">
          

<!-- Only show if we have sidebars configured, else just a small margin  -->
<div class="bd-sidebar-primary col-12 col-md-3 bd-sidebar">
  <div class="sidebar-start-items"><nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
  <div class="bd-toc-item active">
    <ul class="current nav bd-sidenav">
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../../os_setup/">
   Настройка вашей ОС
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../../os_setup/choose_compiler/">
     Выбор компилятора
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../os_setup/install_gfortran/">
     Установка GFortran
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../os_setup/text_editors/">
     Текстовые редакторы
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../os_setup/ides/">
     IDE (Интегрированная среда разработки)
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../os_setup/tips/">
     Полезные советы
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../../quickstart/">
   Краткое руководство
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/>
  <label for="toctree-checkbox-2">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../../quickstart/hello_world/">
     Hello world
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../quickstart/variables/">
     Переменные
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../quickstart/arrays_strings/">
     Массивы и строки
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../quickstart/operators_control_flow/">
     Операторы и поток управления
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../quickstart/organising_code/">
     Организация структуры кода
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../quickstart/derived_types/">
     Производные типы данных
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 current active has-children">
  <a class="reference internal" href="../">
   Сборка программ
  </a>
  <input checked="" class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/>
  <label for="toctree-checkbox-3">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul class="current">
   <li class="toctree-l2">
    <a class="reference internal" href="../compiling_source/">
     Компиляция исходного кода
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../linking_pieces/">
     Компоновка объектов
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../runtime_libraries/">
     Библиотеки времени выполнения
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../include_files/">
     Подключаемые файлы и модули
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../managing_libraries/">
     Управление библиотеками (статические и динамические библиотеки)
    </a>
   </li>
   <li class="toctree-l2 current active">
    <a class="current reference internal" href="#">
     Инструменты сборки
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../project_make/">
     Введение в систему сборки make
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../distributing/">
     Распространение ваших программ
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../../best_practices/">
   Практические рекомендации по разработке на Fortran
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/>
  <label for="toctree-checkbox-4">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../../best_practices/style_guide/">
     Руководство по стилю оформления кода Fortran
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../best_practices/floating_point/">
     Числа с плавающей точкой
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../best_practices/integer_division/">
     Целочисленное деление
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../best_practices/modules_programs/">
     Модули и программы
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../best_practices/arrays/">
     Массивы
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../best_practices/multidim_arrays/">
     Многомерные массивы
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../best_practices/element_operations/">
     Элементные операции с массивами
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../best_practices/allocatable_arrays/">
     Выделяемые (динамические) массивы
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../best_practices/file_io/">
     Файловый ввод/вывод
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../best_practices/callbacks/">
     Функции обратного вызова
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../best_practices/type_casting/">
     Приведение типа в функциях обратного вызова
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../../intrinsics/">
   Fortran Intrinsics
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" type="checkbox"/>
  <label for="toctree-checkbox-5">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../../intrinsics/array/">
     Properties and attributes of arrays
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../intrinsics/bit/">
     Bit-level inquiry and manipulation
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../intrinsics/character/">
     Basic procedures for manipulating
     <em>
      character
     </em>
     variables
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../intrinsics/compiler/">
     Information about compiler and compiler options used for building
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../intrinsics/cfi/">
     Procedures for binding to C interfaces
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../intrinsics/math/">
     General mathematical functions
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../intrinsics/model/">
     Controlling and querying the current numeric model
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../intrinsics/numeric/">
     Manipulation and properties of numeric values
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../intrinsics/parallel/">
     Parallel programming using co_arrays and co_indexed arrays
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../intrinsics/state/">
     General and miscellaneous intrinsics
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../intrinsics/system/">
     Accessing external system information
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../intrinsics/transform/">
     Matrix multiplication, dot product, and array shifts
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../intrinsics/type/">
     Types and kinds
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference external" href="https://www.gnu.org/licenses/old-licenses/fdl-1.2.en.html">
     GNU Free Documentation License
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../rosetta_stone/">
   Python Fortran Rosetta Stone
  </a>
 </li>
</ul>

  </div>
</nav>
  </div>
  <div class="sidebar-end-items">
  </div>
</div>


          


<div class="bd-sidebar-secondary d-none d-xl-block col-xl-2 bd-toc">
  
    
    <div class="toc-item">
        
<br />

<div class="tocsection onthispage">
  <i class="fas fa-list"></i> On this page
</div>

<nav id="bd-toc-nav" class="page-toc"><ul class="nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#using-make-as-build-tool">
   Использование make как инструмент сборки
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#recursively-expanded-variables">
     Рекурсивно расширяемые переменные
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#comments-and-whitespace">
     Комментарии и символ пробела
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#the-meson-build-system">
   Система сборки meson
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#creating-a-cmake-project">
   Создание проекта в системе сборки CMake
  </a>
 </li>
</ul>
</nav> 
    </div>
    
  
</div>


          
          
          <div class="bd-content col-12 col-md-9 col-xl-7">
              
              <article class="bd-article" role="main">
                
<section class="tex2jax_ignore mathjax_ignore" id="build-tools">
<h1>Инструменты сборки<a class="headerlink" href="#build-tools" title="Permalink to this heading">#</a></h1>
<p>Компиляция ваших проектов на языке Fortran вручную может стать довольно сложной задачей по мере роста числа файлов исходного кода и зависимостей в файлах модулей. Поддержка различных компиляторов и компоновщиков или различных платформ может стать все более сложной, если не использовать правильные инструменты для автоматического выполнения этих задач.</p>
<p>В зависимости от размера и цели вашего проекта могут быть использованы различные варианты автоматизации сборки.</p>
<p>Прежде всего, ваша интегрированная среда разработки (IDE), возможно, предоставляет способ сборки вашей программы. Популярным кроссплатформенным инструментом является <a href="https://code.visualstudio.com/" target="_blank" rel="noopener">Visual Studio Code</a> от Microsoft, но существуют и другие, такие как <a href="https://atom.io/" target="_blank" rel="noopener">Atom</a>, <a href="https://www.eclipse.org/photran/" target="_blank" rel="noopener">Eclipse Photran</a>, и <a href="http://www.codeblocks.org/" target="_blank" rel="noopener">Code::Blocks</a>. Они предлагают пользовательский интерфейс, но часто очень специфичны для компилятора и платформы.</p>
<p>Для небольших проектов часто используется система сборки <code class="docutils literal notranslate"><span class="pre">make</span></code>. На основе заданных правил она может выполнять такие задачи, как (пере)компиляция объектных файлов из обновлённых файлов исходных кодов, создание библиотек, и компоновка исполняемых файлов. Чтобы использовать <code class="docutils literal notranslate"><span class="pre">make</span></code>, для вашего проекта вы должны создать эти правила в файле <code class="docutils literal notranslate"><span class="pre">Makefile</span></code>, который определяет взаимозависимости всех конечных программ, промежуточных объектных файлов или библиотек и непосредственно файлов исходных кодов. Краткое введение по этой системе сборки приводится <a class="reference internal" href="#using-make-as-build-tool">в руководстве по <code class="docutils literal notranslate"><span class="pre">make</span></code></a>.</p>
<p>Инструменты сопровождения, такие как autotools и CMake, могут генерировать файлы Makefile или файлы проектов Visual Studio через высокоуровневое описание. Они абстрагируются от специфики компилятора и платформы.</p>
<p>Какой из этих инструментов лучше выбрать для ваших проектов, зависит от многих факторов. Выбирайте инструмент сборки, с которым вам удобно работать, он не должен мешать вам во время разработки. Если тратить больше времени на работу с инструментом сборки, чем на саму разработку, то это может быстро надоесть.</p>
<p>Также обратите внимание на доступность инструментов сборки. Если их использование ограничено одной IDE, смогут ли все разработчики вашего проекта получить к ним доступ? Если вы используете определённую систему сборки, работает ли она на всех платформах, для которых вы разрабатываете? Насколько велик входной порог для ваших инструментов сборки? Предварительно узнайте о кривой обучения для инструментов сборки – идеальный инструмент сборки будет бесполезен, если сначала вам сначала придётся изучить сложный язык программирования, чтобы добавить новый файл исходного кода. Наконец, посмотрите, какие другие проекты вы используете как зависимости и какие используют (или будут использовать) ваш проект как зависимость.</p>
<section id="using-make-as-build-tool">
<h2>Использование make как инструмент сборки<a class="headerlink" href="#using-make-as-build-tool" title="Permalink to this heading">#</a></h2>
<p>Наиболее известная и часто используемая система сборки называется <code class="docutils literal notranslate"><span class="pre">make</span></code>. Она выполняет действия, следуя правилам, определенным в конфигурационном файле, называемом <code class="docutils literal notranslate"><span class="pre">Makefile</span></code> или <code class="docutils literal notranslate"><span class="pre">makefile</span></code>, что обычно приводит к компиляции программы из предоставленного исходного кода.</p>
<div class="admonition tip">
<p class="admonition-title">Совет</p>
<p>Для ознакомления с подробным руководством по <code class="docutils literal notranslate"><span class="pre">make</span></code> смотрите его информационную страницу. Существует онлайн версия этой информационной страницы, доступная по <a href="https://www.gnu.org/software/make/manual/make.html" target="_blank" rel="noopener">ссылке</a>.</p>
</div>
<p>Мы начнём с основ, находясь в пустом каталоге. Создайте и откройте файл с именем <code class="docutils literal notranslate"><span class="pre">Makefile</span></code>, в котором создайте простое правило под названием <em>all</em>:</p>
<div class="highlight-make notranslate"><div class="highlight"><pre><span></span><span class="nf">all</span><span class="o">:</span>
<span class="w">	</span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$@</span><span class="s2">&quot;</span>
</pre></div>
</div>
<p>После сохранения файла <code class="docutils literal notranslate"><span class="pre">Makefile</span></code> запустите его, выполнив команду <code class="docutils literal notranslate"><span class="pre">make</span></code> в той же директории. Вы должны будете увидеть следующий вывод:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>echo &quot;all&quot;
all
</pre></div>
</div>
<p>Во-первых, заметим, что <code class="docutils literal notranslate"><span class="pre">make</span></code> подставляем вместо <code class="docutils literal notranslate"><span class="pre">$&#64;</span></code> имя правила; во-вторых, что следует отметить, <code class="docutils literal notranslate"><span class="pre">make</span></code> всегда выводит выполняемую команду; наконец, мы видим результат выполнения команды <code class="docutils literal notranslate"><span class="pre">echo</span> <span class="pre">\&quot;all\&quot;</span></code>.</p>
<div class="admonition note">
<p class="admonition-title">Примечание</p>
<p>Мы всегда называем точку входа нашего <code class="docutils literal notranslate"><span class="pre">Makefile</span></code> <em>all</em> по договорённости, но вы можете выбрать для неё любое другое имя, которое вам нравится.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Примечание</p>
<p>Вы не должны были заметить этого, если ваш редактор работает правильно, но при описании правила отступы следует делать используя символ табуляции. Если у вас возникли проблемы с запуском приведённого выше <code class="docutils literal notranslate"><span class="pre">Makefile</span></code> и вы видите ошибку, похожую на такую</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Makefile:2: *** missing separator.  Stop.
</pre></div>
</div>
<p>Вероятно, отступ сделан неправильно. В этом случае, используйте для отступа во второй строке символ табуляции.</p>
</div>
<p>Теперь мы хотим усложнить наши правила, поэтому добавим ещё одно:</p>
<div class="highlight-make notranslate"><div class="highlight"><pre><span></span><span class="nv">PROG</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span>my_prog

<span class="nf">all</span><span class="o">:</span><span class="w"> </span><span class="k">$(</span><span class="nv">PROG</span><span class="k">)</span>
<span class="w">	</span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$@</span><span class="s2"> depends on </span>$<span class="s2">^&quot;</span>

<span class="nf">$(PROG)</span><span class="o">:</span>
<span class="w">	</span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$@</span><span class="s2">&quot;</span>
</pre></div>
</div>
<p>Обратите внимание, как мы объявляем переменные в <code class="docutils literal notranslate"><span class="pre">make</span></code>: вы всегда должны объявлять свои локальные переменные с помощью оператора <code class="docutils literal notranslate"><span class="pre">:=</span></code>. Для доступа к содержимому переменной используется оператор <code class="docutils literal notranslate"><span class="pre">$(...)</span></code>. Заметьте, что при этом необходимо заключить имя переменной в круглые скобки.</p>
<div class="admonition note">
<p class="admonition-title">Примечание</p>
<p>Объявление переменных обычно выполняется с помощью оператора <code class="docutils literal notranslate"><span class="pre">:=</span></code>, но <code class="docutils literal notranslate"><span class="pre">make</span></code> поддерживает и <em>рекурсивно расширяемые</em> переменные с помощью оператора <code class="docutils literal notranslate"><span class="pre">=</span></code>. Обычно желательно использовать первый тип объявления, так как такие переменные более предсказуемы и не имеют накладных расходов во время выполнения из-за рекурсивного расширения.</p>
</div>
<p>Мы добавили зависимость для правила <em>all</em>, а именно содержимое переменной <code class="docutils literal notranslate"><span class="pre">PROG</span></code>. Также мы изменили вывод, чтобы видеть все зависимости этого правила, которые хранятся в переменной <code class="docutils literal notranslate"><span class="pre">$^</span></code>. Теперь для нового правила, которое мы назвали по значению переменной <code class="docutils literal notranslate"><span class="pre">PROG</span></code>, выполняются те же операции, что были выполнены выше для правила <em>all</em>. Обратите внимание, как значение переменной <code class="docutils literal notranslate"><span class="pre">$&#64;</span></code> зависит от правила, в котором она используется.</p>
<p>Выполнив команду <code class="docutils literal notranslate"><span class="pre">make</span></code> снова, теперь вы должны увидеть:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>echo &quot;my_prog&quot;
my_prog
echo &quot;all depends on my_prog&quot;
all depends on my_prog
</pre></div>
</div>
<p>Зависимость была правильно разрешена и вычислена перед выполнением любого действия в правиле <em>all</em>. Давайте запустим выполнение только второго правила: наберите команду <code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">my_prog</span></code> и в вашем терминале отобразятся только первые две строки предыдущего вывода.</p>
<p>Следующим шагом будет выполнение некоторых реальных действий с помощью <code class="docutils literal notranslate"><span class="pre">make</span></code>, мы возьмем исходный код из предыдущей главы и добавим новые правила в наш <code class="docutils literal notranslate"><span class="pre">Makefile</span></code>:</p>
<div class="highlight-make notranslate"><div class="highlight"><pre><span></span><span class="nv">OBJS</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span>tabulate.o<span class="w"> </span>functions.o
<span class="nv">PROG</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span>my_prog

<span class="nf">all</span><span class="o">:</span><span class="w"> </span><span class="k">$(</span><span class="nv">PROG</span><span class="k">)</span>

<span class="nf">$(PROG)</span><span class="o">:</span><span class="w"> </span><span class="k">$(</span><span class="nv">OBJS</span><span class="k">)</span>
<span class="w">	</span>gfortran<span class="w"> </span>-o<span class="w"> </span><span class="nv">$@</span><span class="w"> </span>$^

<span class="nf">$(OBJS)</span><span class="o">:</span><span class="w"> </span>%.<span class="n">o</span>: %.<span class="n">f</span>90
<span class="w">	</span>gfortran<span class="w"> </span>-c<span class="w"> </span>-o<span class="w"> </span><span class="nv">$@</span><span class="w"> </span>$&lt;
</pre></div>
</div>
<p>Мы определили переменную <code class="docutils literal notranslate"><span class="pre">OBJS</span></code>, содержащую список объектных файлов. Наша программа зависит от списка <code class="docutils literal notranslate"><span class="pre">OBJS</span></code> и для каждого элемента из него мы создаём правило, чтобы скомпилировать объектный файл из файла исходного кода. Последнее правило, которое мы описали является правилом сопоставления шаблонов, где <code class="docutils literal notranslate"><span class="pre">%</span></code> – общий шаблон между <code class="docutils literal notranslate"><span class="pre">tabulate.o</span></code> и <code class="docutils literal notranslate"><span class="pre">tabulate.f90</span></code>, который соединяет наш объектный файл <code class="docutils literal notranslate"><span class="pre">tabulate.o</span></code> с файлом исходного кода <code class="docutils literal notranslate"><span class="pre">tabulate.f90</span></code>. Используя этот набор, мы запускаем компилятор <code class="docutils literal notranslate"><span class="pre">gfortran</span></code> и транслируем исходный код в объектный файл, при этом исполняемый файл пока не создаётся, так как используется ключ компилятора <code class="docutils literal notranslate"><span class="pre">-c</span></code>. Обратите внимание на использование переменной <code class="docutils literal notranslate"><span class="pre">$&lt;</span></code> для обращения к первому элементу списка зависимостей.</p>
<p>После компиляции всех объектных файлов мы пытаемся скомпоновать программу, используя компоновщик не напрямую, а вызывая компилятор <code class="docutils literal notranslate"><span class="pre">gfortran</span></code>, чтобы создать исполняемый файл.</p>
<p>Теперь мы запускаем сценарий сборки командой <code class="docutils literal notranslate"><span class="pre">make</span></code>:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>gfortran -c -o tabulate.o tabulate.f90
tabulate.f90:2:7:

    2 |    use user_functions
      |       1
Fatal Error: Cannot open module file ‘user_functions.mod’ for reading at (1): No such file or directory
compilation terminated.
make: *** [Makefile:10: tabulate.f90.o] Error 1
</pre></div>
</div>
<p>Мы помним, что у нас есть зависимости между нашими исходными файлами, поэтому мы явно добавляем эту зависимость в <code class="docutils literal notranslate"><span class="pre">Makefile</span></code> с помощью правила</p>
<div class="highlight-make notranslate"><div class="highlight"><pre><span></span><span class="nf">tabulate.o</span><span class="o">:</span><span class="w"> </span><span class="n">functions</span>.<span class="n">o</span>
</pre></div>
</div>
<p>Теперь мы можем повторить попытку запуска сценария сборки и убедиться, что процесс сборки работает правильно. Вывод должен выглядеть следующим образом</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>gfortran -c -o functions.o functions.f90
gfortran -c -o tabulate.o tabulate.f90
gfortran -o my_prog tabulate.o functions.o
</pre></div>
</div>
<p>В каталоге должны появиться <em>четыре</em> новых файла. Запустите программу <code class="docutils literal notranslate"><span class="pre">my_prog</span></code>, чтобы убедиться, что она работает как ожидается. Попробуйте выполнить команду <code class="docutils literal notranslate"><span class="pre">make</span></code> ещё раз:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>make: Nothing to be done for &#39;all&#39;.
</pre></div>
</div>
<p>Используя временные метки исполняемого файла <code class="docutils literal notranslate"><span class="pre">make</span></code> определил, что исполняемый файл новее чем каждый из файлов <code class="docutils literal notranslate"><span class="pre">tabulate.o</span></code> и <code class="docutils literal notranslate"><span class="pre">functions.o</span></code>, которые, в свою очередь, новее чем файлы исходного кода <code class="docutils literal notranslate"><span class="pre">tabulate.f90</span></code> и <code class="docutils literal notranslate"><span class="pre">functions.f90</span></code>. Поэтому программа уже соответствует содержимому файлов исходного кода и никаких действий по её пересборке выполнять не нужно.</p>
<p>В заключение мы рассмотрим готовый вариант скрипта <code class="docutils literal notranslate"><span class="pre">Makefile</span></code>.</p>
<div class="highlight-make notranslate"><div class="highlight"><pre><span></span><span class="c"># Disable all of make&#39;s built-in rules (similar to Fortran&#39;s implicit none)</span>
<span class="nv">MAKEFLAGS</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span>--no-builtin-rules<span class="w"> </span>--no-builtin-variables
<span class="c"># configuration</span>
<span class="nv">FC</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span>gfortran
<span class="nv">LD</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="k">$(</span>FC<span class="k">)</span>
<span class="nv">RM</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span>rm<span class="w"> </span>-f
<span class="c"># list of all source files</span>
<span class="nv">SRCS</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span>tabulate.f90<span class="w"> </span>functions.f90
<span class="nv">PROG</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span>my_prog

<span class="nv">OBJS</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="k">$(</span>addsuffix<span class="w"> </span>.o,<span class="w"> </span><span class="k">$(</span>SRCS<span class="k">))</span>

<span class="nf">.PHONY</span><span class="o">:</span><span class="w"> </span><span class="n">all</span> <span class="n">clean</span>
<span class="nf">all</span><span class="o">:</span><span class="w"> </span><span class="k">$(</span><span class="nv">PROG</span><span class="k">)</span>

<span class="nf">$(PROG)</span><span class="o">:</span><span class="w"> </span><span class="k">$(</span><span class="nv">OBJS</span><span class="k">)</span>
<span class="w">	</span><span class="k">$(</span>LD<span class="k">)</span><span class="w"> </span>-o<span class="w"> </span><span class="nv">$@</span><span class="w"> </span>$^

<span class="nf">$(OBJS)</span><span class="o">:</span><span class="w"> </span>%.<span class="n">o</span>: %
<span class="w">	</span><span class="k">$(</span>FC<span class="k">)</span><span class="w"> </span>-c<span class="w"> </span>-o<span class="w"> </span><span class="nv">$@</span><span class="w"> </span>$&lt;

<span class="c"># define dependencies between object files</span>
<span class="nf">tabulate.f90.o</span><span class="o">:</span><span class="w"> </span><span class="n">functions</span>.<span class="n">f</span>90.<span class="n">o</span> <span class="n">user_functions</span>.<span class="n">mod</span>

<span class="c"># rebuild all object files in case this Makefile changes</span>
<span class="nf">$(OBJS)</span><span class="o">:</span><span class="w"> </span><span class="k">$(</span><span class="nv">MAKEFILE_LIST</span><span class="k">)</span>

<span class="nf">clean</span><span class="o">:</span>
<span class="w">	</span><span class="k">$(</span>RM<span class="k">)</span><span class="w"> </span><span class="k">$(</span>filter<span class="w"> </span>%.o,<span class="w"> </span><span class="k">$(</span>OBJS<span class="k">))</span><span class="w"> </span><span class="k">$(</span>wildcard<span class="w"> </span>*.mod<span class="k">)</span><span class="w"> </span><span class="k">$(</span>PROG<span class="k">)</span>
</pre></div>
</div>
<p>Поскольку вы начинаете с системы сборки <code class="docutils literal notranslate"><span class="pre">make</span></code> мы настоятельно рекомендуем всегда добавлять указанную первую строчку, так как и в случае с оператором Fortran <code class="docutils literal notranslate"><span class="pre">implicit</span> <span class="pre">none</span></code>, мы не хотим, чтобы неявные правила испортили наш <code class="docutils literal notranslate"><span class="pre">Makefile</span></code> неожиданным и вредным образом.</p>
<p>Далее идёт раздел конфигурации, где мы определяем переменные. В случае если вы захотите указать другой компилятор, это легко сделать здесь. Мы также ввели переменную <code class="docutils literal notranslate"><span class="pre">SRCS</span></code> для хранения списка всех файлов исходного кода, что более интуитивно понятно, чем указание списка объектных файлов. Мы можем легко создать список объектных файлов, добавив суффикс <code class="docutils literal notranslate"><span class="pre">.o</span></code> при помощи функции <code class="docutils literal notranslate"><span class="pre">addsuffix</span></code>. <code class="docutils literal notranslate"><span class="pre">.PHONY</span></code> – специальное правило, которое должно использоваться для всех точек входа вашего <code class="docutils literal notranslate"><span class="pre">Makefile</span></code>. В нём мы определяем две точки входа: уже известное нам правило <em>all</em> и новое правило <em>clean</em>, которое удаляет все файлы, полученные в процессе сборки программы, чтобы следующая сборка выполнялась с самого начала.</p>
<p>Также мы немного изменили правило сборки для объектных файлов, чтобы учесть добавление суффикса <code class="docutils literal notranslate"><span class="pre">.o</span></code> вместо замены на него. Обратите внимание, что нам по прежнему нужно явно определять взаимозависимости в <code class="docutils literal notranslate"><span class="pre">Makefile</span></code>. Мы также добавили зависимость для объектных файлов от самого <code class="docutils literal notranslate"><span class="pre">Makefile</span></code>, на случай если вы укажите другой компилятор. Это позволит вам безопасно выполнить пересборку.</p>
<p>Теперь вы знаете о <code class="docutils literal notranslate"><span class="pre">make</span></code> достаточно, чтобы использовать его для создания небольших проектов. Если вы планируете использовать <code class="docutils literal notranslate"><span class="pre">make</span></code> более широко, мы подготовили для вас несколько советов.</p>
<div class="admonition tip">
<p class="admonition-title">Совет</p>
<p>В этом руководстве мы избегали использования и отключили многие часто используемые возможности <code class="docutils literal notranslate"><span class="pre">make</span></code>, которые могут быть особенно проблемными при неправильном применении. Мы настоятельно рекомендуем воздержаться от использования встроенных правил и переменных, если вы не чувствуете себя уверенно при работе с <code class="docutils literal notranslate"><span class="pre">make</span></code>, и использовать явное объявление переменных и правил.</p>
<p>Вы обнаружите, что <code class="docutils literal notranslate"><span class="pre">make</span></code> является удобным инструментом для автоматизации коротких взаимозависимых рабочих процессов и создания небольших проектов. Но для больших проектов вы, вероятно, вскоре столкнётесь с некоторыми его ограничениями. Поэтому обычно <code class="docutils literal notranslate"><span class="pre">make</span></code> используется не сам по себе, а в сочетании с другими инструментами для создания файла <code class="docutils literal notranslate"><span class="pre">Makefile</span></code> полностью или создания его фрагментов.</p>
</div>
<section id="recursively-expanded-variables">
<h3>Рекурсивно расширяемые переменные<a class="headerlink" href="#recursively-expanded-variables" title="Permalink to this heading">#</a></h3>
<p>Во многих проектах часто встречаются рекурсивно расширяемые переменные (объявление с использованием оператора <code class="docutils literal notranslate"><span class="pre">=</span></code> вместо <code class="docutils literal notranslate"><span class="pre">:=</span></code>). Рекурсивное расширение ваших переменных позволяет объявлять их не по порядку и делать другие хитрые трюки с использованием <code class="docutils literal notranslate"><span class="pre">make</span></code>, так как они определяются как правила, которые расширяются во время выполнения, а не во время анализа.</p>
<p>Например, объявление и использование ваших флагов компиляции Fortran с помощью приведённого ниже фрагмента будет работать совершенно нормально:</p>
<div class="highlight-make notranslate"><div class="highlight"><pre><span></span><span class="nf">all</span><span class="o">:</span>
<span class="w">	</span><span class="nb">echo</span><span class="w"> </span><span class="k">$(</span>FFLAGS<span class="k">)</span>

<span class="nv">FFLAGS</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">$(</span>include_dirs<span class="k">)</span><span class="w"> </span>-O
<span class="nv">include_dirs</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span>-I./include
<span class="nv">include_dirs</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span>-I/opt/some_dep/include
</pre></div>
</div>
<p>После выполнения команды <code class="docutils literal notranslate"><span class="pre">make</span></code> вы должны получить ожидаемый (или, возможно, неожиданный) вывод</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>echo -I./include -I/opt/some_dep/include -O
-I./include -I/opt/some_dep/include -O
</pre></div>
</div>
<div class="admonition tip">
<p class="admonition-title">Совет</p>
<p>добавление к списку с помощью оператора <code class="docutils literal notranslate"><span class="pre">+=</span></code> для неинициализированной переменной приведёт к её рекурсивному расширению, причём это состояние будет наследоваться при всех дальнейших добавлениях.</p>
</div>
<p>Хотя эта возможность кажется интересной, она имеет тенденцию приводить к удивительным и неожиданным результатам. Обычно при определении переменных для вашего компилятора нет особых причин использовать рекурсивное расширение.</p>
<p>Нужного эффекта при объявлении можно добиться используя оператор <code class="docutils literal notranslate"><span class="pre">:=</span></code>:</p>
<div class="highlight-make notranslate"><div class="highlight"><pre><span></span><span class="nf">all</span><span class="o">:</span>
<span class="w">	</span><span class="nb">echo</span><span class="w"> </span><span class="k">$(</span>FFLAGS<span class="k">)</span>

<span class="nv">include_dirs</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span>-I./include
<span class="nv">include_dirs</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span>-I/opt/some_dep/include
<span class="nv">FFLAGS</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="k">$(</span>include_dirs<span class="k">)</span><span class="w"> </span>-O
</pre></div>
</div>
<div class="admonition important">
<p class="admonition-title">Важно</p>
<p>всегда думайте о содержимом файла <code class="docutils literal notranslate"><span class="pre">Makefile</span></code> как о целом наборе правил, так как он должен быть полностью проанализирован, прежде чем любое правило сможет быть выполнено.</p>
</div>
<p>Вы можете использовать любой вид переменных, который вам больше нравится, но смешивать их использование следует с осторожностью. Важно знать о различиях между этими двумя видами и о соответствующих последствиях.</p>
</section>
<section id="comments-and-whitespace">
<h3>Комментарии и символ пробела<a class="headerlink" href="#comments-and-whitespace" title="Permalink to this heading">#</a></h3>
<p>Есть некоторые предостережения по поводу символа пробела и комментариев, которые могут время от времени проявляться при использовании <code class="docutils literal notranslate"><span class="pre">make</span></code>. Во-первых, утилита <code class="docutils literal notranslate"><span class="pre">make</span></code> не знает ни одного типа данных, кроме строк и разделителем по умолчанию является пробел. Это означает, что <code class="docutils literal notranslate"><span class="pre">make</span></code> будет испытывать трудности при попытке собрать проект, в именах файлов которого используются символы пробела. Если вы столкнулись с такой проблемой, то переименование файла, возможно, будет самым простым её решением.</p>
<p>Другая распространённая проблема – символы пробела в начале и конце строки. Если их ввести, то <code class="docutils literal notranslate"><span class="pre">make</span></code> воспримет их как часть строки и это повлияет на содержимое этих строк внутри файла <code class="docutils literal notranslate"><span class="pre">make</span></code>.</p>
<p>Такое может произойти при добавлении комментария</p>
<div class="highlight-make notranslate"><div class="highlight"><pre><span></span><span class="nv">prefix</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span>/usr<span class="w">  </span><span class="c1"># path to install location</span>
<span class="nf">install</span><span class="o">:</span>
<span class="w">	</span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;</span><span class="k">$(</span>prefix<span class="k">)</span><span class="s2">/lib&quot;</span>
</pre></div>
</div>
<p>Хотя комментарий будет корректно удалён при анализе утилитой <code class="docutils literal notranslate"><span class="pre">make</span></code>, но два завершающих пробельных символа являются частью содержимого переменной. Запустите команду <code class="docutils literal notranslate"><span class="pre">make</span></code> и убедитесь, что это действительно так:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">echo</span> <span class="s2">&quot;/usr  /lib&quot;</span>
<span class="o">/</span><span class="n">usr</span>  <span class="o">/</span><span class="n">lib</span>
</pre></div>
</div>
<p>Чтобы разрешить эту проблему, вы можете либо перенести комментарий на следующую строку, либо удалить пробелы в содержимом переменной с помощью функции <code class="docutils literal notranslate"><span class="pre">strip</span></code>. В качестве альтернативного решения можно попробовать соединить строки с помощью функции <code class="docutils literal notranslate"><span class="pre">join</span></code>.</p>
<div class="highlight-make notranslate"><div class="highlight"><pre><span></span><span class="nv">prefix</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span>/usr<span class="w">  </span><span class="c1"># path to install location</span>
<span class="nf">install</span><span class="o">:</span>
<span class="w">	</span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;</span><span class="k">$(</span>strip<span class="w"> </span><span class="k">$(</span>prefix<span class="k">))</span><span class="s2">/lib&quot;</span>
<span class="w">	</span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;</span><span class="k">$(</span>join<span class="w"> </span><span class="k">$(</span>join<span class="w"> </span><span class="k">$(</span>prefix<span class="k">)</span>,<span class="w"> </span>/<span class="k">)</span>,<span class="w"> </span>lib<span class="k">)</span><span class="s2">&quot;</span>
</pre></div>
</div>
<p>В целом, ни одно из этих решений не сделает ваш файл <code class="docutils literal notranslate"><span class="pre">Makefile</span></code> более удобным для чтения, поэтому при написании и использовании правил <code class="docutils literal notranslate"><span class="pre">make</span></code> следует уделять повышенное внимание символам пробела и комментариям.</p>
</section>
</section>
<section id="the-meson-build-system">
<h2>Система сборки meson<a class="headerlink" href="#the-meson-build-system" title="Permalink to this heading">#</a></h2>
<p>После того, как вы изучили основы <code class="docutils literal notranslate"><span class="pre">make</span></code>,которую мы называем низкоуровневой системой сборки, мы ознакомим вас с <code class="docutils literal notranslate"><span class="pre">meson</span></code>, высокоуровневой системой сборки. В то время как в низкоуровневой системе сборки вы указываете, как собрать вашу программу, в высокоуровневой системе сборки вы можете указать, что собирать. Высокоуровневая система сборки определит как создать файлы сборки для низкоуровневой системы сборки и сгенерирует их за вас.</p>
<p>Существует множество высокоуровневых систем сборки, но мы остановимся на <code class="docutils literal notranslate"><span class="pre">meson</span></code> , потому что она построена так, чтобы быть особенно удобной для пользователя. Низкоуровневая система сборки, используемая в <code class="docutils literal notranslate"><span class="pre">meson</span></code> по умолчанию, называется <code class="docutils literal notranslate"><span class="pre">ninja</span></code>.</p>
<p>Давайте посмотрим на готовый файл <code class="docutils literal notranslate"><span class="pre">meson.build</span></code>:</p>
<!-- meson is unknown by the highlighter, python looks okayish -->
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">project</span><span class="p">(</span><span class="s1">&#39;my_proj&#39;</span><span class="p">,</span> <span class="s1">&#39;fortran&#39;</span><span class="p">,</span> <span class="n">meson_version</span><span class="p">:</span> <span class="s1">&#39;&gt;=0.49&#39;</span><span class="p">)</span>
<span class="n">executable</span><span class="p">(</span><span class="s1">&#39;my_prog&#39;</span><span class="p">,</span> <span class="n">files</span><span class="p">(</span><span class="s1">&#39;tabulate.f90&#39;</span><span class="p">,</span> <span class="s1">&#39;functions.f90&#39;</span><span class="p">))</span>
</pre></div>
</div>
<p>И этого достаточно, следующим шагом будет настройка нашей низкоуровневой системы сборки с помощью команды <code class="docutils literal notranslate"><span class="pre">meson</span> <span class="pre">setup</span> <span class="pre">build</span></code>, в результате выполнения которой вы должны увидеть результат, похожий на этот</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>The Meson build system
Version: 0.53.2
Source dir: /home/awvwgk/Examples
Build dir: /home/awvwgk/Examples/build
Build type: native build
Project name: my_proj
Project version: undefined
Fortran compiler for the host machine: gfortran (gcc 9.2.1 &quot;GNU Fortran (Arch Linux 9.2.1+20200130-2) 9.2.1 20200130&quot;)
Fortran linker for the host machine: gfortran ld.bfd 2.34
Host machine cpu family: x86_64
Host machine cpu: x86_64
Build targets in project: 1

Found ninja-1.10.0 at /usr/bin/ninja
</pre></div>
</div>
<p>Представленная информация на данный момент уже более подробна, чем все, что мы могли бы описать в файле <code class="docutils literal notranslate"><span class="pre">Makefile</span></code>. Давайте запустим сборку с помощью команды <code class="docutils literal notranslate"><span class="pre">ninja</span> <span class="pre">-C</span> <span class="pre">build</span></code>, в результате выполнения которой отобразится что-то похожее на вывод</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>[1/4] Compiling Fortran object &#39;my_prog@exe/functions.f90.o&#39;.
[2/4] Dep hack
[3/4] Compiling Fortran object &#39;my_prog@exe/tabulate.f90.o&#39;.
[4/4] Linking target my_prog.
</pre></div>
</div>
<p>Найдите и протестируйте свою программу в каталоге <code class="docutils literal notranslate"><span class="pre">build/my_prog</span></code>, чтобы убедиться, что она работает правильно. Заметим, что последовательность шагов, которую выполнила система сборки <code class="docutils literal notranslate"><span class="pre">ninja</span></code>, аналогична той, которую бы мы записали в <code class="docutils literal notranslate"><span class="pre">Makefile</span></code> (включая указание зависимости), но нам не пришлось её явно описывать. Посмотрите ещё раз на свой файл <code class="docutils literal notranslate"><span class="pre">meson.build</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">project</span><span class="p">(</span><span class="s1">&#39;my_proj&#39;</span><span class="p">,</span> <span class="s1">&#39;fortran&#39;</span><span class="p">,</span> <span class="n">meson_version</span><span class="p">:</span> <span class="s1">&#39;&gt;=0.49&#39;</span><span class="p">)</span>
<span class="n">executable</span><span class="p">(</span><span class="s1">&#39;my_prog&#39;</span><span class="p">,</span> <span class="n">files</span><span class="p">(</span><span class="s1">&#39;tabulate.f90&#39;</span><span class="p">,</span> <span class="s1">&#39;functions.f90&#39;</span><span class="p">))</span>
</pre></div>
</div>
<p>Мы только указали, что у нас есть проект на языке Fortran (для поддержки проектов на языке Fortran требуется определенная версия <code class="docutils literal notranslate"><span class="pre">meson</span></code>) и сказали системе сборки <code class="docutils literal notranslate"><span class="pre">meson</span></code> собрать исполняемый файл <code class="docutils literal notranslate"><span class="pre">my_prog</span></code> из файлов исходного кода <code class="docutils literal notranslate"><span class="pre">tabulate.f90</span></code> и <code class="docutils literal notranslate"><span class="pre">functions.f90</span></code>. Нам не нужно было указывать <code class="docutils literal notranslate"><span class="pre">meson</span></code>, как собирать проект, система сборки разобралась с этим сама.</p>
<div class="admonition note">
<p class="admonition-title">Примечание</p>
<p><code class="docutils literal notranslate"><span class="pre">meson</span></code> является кроссплатформенной системой сборки, поэтому файл её проекта, который вы только что создали для своей программы, может быть использован для компиляции исполняемых файлов для вашей родной операционной системы или для кросс-компиляции вашего проекта для других платформ. Аналогично, файл <code class="docutils literal notranslate"><span class="pre">meson.build</span></code> является переносимым и будет работать на разных платформах.</p>
</div>
<p>Документация системы сборки <code class="docutils literal notranslate"><span class="pre">meson</span></code> доступна на <a href="https://mesonbuild.com/" target="_blank" rel="noopener">веб-странице meson-build</a>.</p>
</section>
<section id="creating-a-cmake-project">
<h2>Создание проекта в системе сборки CMake<a class="headerlink" href="#creating-a-cmake-project" title="Permalink to this heading">#</a></h2>
<p>Подобно <code class="docutils literal notranslate"><span class="pre">meson</span></code>, система сборки CMake является высокоуровневой и часто используется для сборки проектов на языке Fortran.</p>
<div class="admonition note">
<p class="admonition-title">Примечание</p>
<p>CMake придерживается несколько иной стратегии и предоставляет вам полный язык программирования для создания файлов сборки. Преимуществом является то, что с помощью CMake, можно делать практически все, но ваши файлы сборки CMake могут стать такими же сложными, как и программа, которую вы собираете.</p>
</div>
<p>Начните с создания файла <code class="docutils literal notranslate"><span class="pre">CMakeLists.txt</span></code> со следующим содержимым</p>
<div class="highlight-cmake notranslate"><div class="highlight"><pre><span></span><span class="nb">cmake_minimum_required</span><span class="p">(</span><span class="s">VERSION</span><span class="w"> </span><span class="s">3.7</span><span class="p">)</span>
<span class="nb">project</span><span class="p">(</span><span class="s2">&quot;my_proj&quot;</span><span class="w"> </span><span class="s">LANGUAGES</span><span class="w"> </span><span class="s2">&quot;Fortran&quot;</span><span class="p">)</span>
<span class="nb">add_executable</span><span class="p">(</span><span class="s2">&quot;my_prog&quot;</span><span class="w"> </span><span class="s2">&quot;tabulate.f90&quot;</span><span class="w"> </span><span class="s2">&quot;functions.f90&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>Как и в случае с <code class="docutils literal notranslate"><span class="pre">meson</span></code>, этого достаточно для сборки нашей программы с помощью файла сборки CMake. Мы настроим наши низкоуровневые файлы сборки с помощью команды <code class="docutils literal notranslate"><span class="pre">cmake</span> <span class="pre">-B</span> <span class="pre">build</span> <span class="pre">-G</span> <span class="pre">Ninja</span></code>, в результате выполнения которой вы увидите вывод, похожий на следующий</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>-- The Fortran compiler identification is GNU 10.2.0
-- Detecting Fortran compiler ABI info
-- Detecting Fortran compiler ABI info - done
-- Check for working Fortran compiler: /usr/bin/f95 - skipped
-- Checking whether /usr/bin/f95 supports Fortran 90
-- Checking whether /usr/bin/f95 supports Fortran 90 - yes
-- Configuring done
-- Generating done
-- Build files have been written to: /home/awvwgk/Examples/build
</pre></div>
</div>
<p>Вас может удивить, что CMake пытается использовать компилятор <code class="docutils literal notranslate"><span class="pre">f95</span></code>. К счастью, в большинстве систем это имя символической ссылки на компилятор <code class="docutils literal notranslate"><span class="pre">gfortran</span></code>, а не непосредственно компилятор <code class="docutils literal notranslate"><span class="pre">f95</span></code>. Чтобы подсказать CMake какой компилятор использовать, вы можете экспортировать переменную окружения <code class="docutils literal notranslate"><span class="pre">FC=gfortran</span></code>. Повторный вызов приведённый выше команды настройки должен отобразить правильное имя компилятора</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>-- The Fortran compiler identification is GNU 10.2.0
-- Detecting Fortran compiler ABI info
-- Detecting Fortran compiler ABI info - done
-- Check for working Fortran compiler: /usr/bin/gfortran - skipped
-- Checking whether /usr/bin/gfortran supports Fortran 90
-- Checking whether /usr/bin/gfortran supports Fortran 90 - yes
-- Configuring done
-- Generating done
-- Build files have been written to: /home/awvwgk/Example/build
</pre></div>
</div>
<p>Аналогичным образом вы можете использовать ваш компилятор Intel Fortran compiler для сборки вашего проекта (установив переменную окружения <code class="docutils literal notranslate"><span class="pre">FC=ifort</span></code>).</p>
<p>CMake обеспечивает поддержку нескольких низкоуровневых файлов сборки, так как по умолчанию они зависят от используемой платформы. Мы будем применять только низкоуровневую систему сборки <code class="docutils literal notranslate"><span class="pre">ninja</span></code>, так как мы уже использовали её вместе с <code class="docutils literal notranslate"><span class="pre">meson</span></code>. Как и прежде, собрать проект при этом можно с помощью команды <code class="docutils literal notranslate"><span class="pre">ninja</span> <span class="pre">-C</span> <span class="pre">build</span></code>:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>[1/6] Building Fortran preprocessed CMakeFiles/my_prog.dir/functions.f90-pp.f90
[2/6] Building Fortran preprocessed CMakeFiles/my_prog.dir/tabulate.f90-pp.f90
[3/6] Generating Fortran dyndep file CMakeFiles/my_prog.dir/Fortran.dd
[4/6] Building Fortran object CMakeFiles/my_prog.dir/functions.f90.o
[5/6] Building Fortran object CMakeFiles/my_prog.dir/tabulate.f90.o
[6/6] Linking Fortran executable my_prog
</pre></div>
</div>
<p>Найдите и протестируйте свою программу в каталоге <code class="docutils literal notranslate"><span class="pre">build/my_prog</span></code>, чтобы убедиться, что она работает правильно. Последовательность шагов, выполняемая системой сборки <code class="docutils literal notranslate"><span class="pre">ninja</span></code> в этот раз несколько отличается, потому что существует более одного способа записи низкоуровневых файлов сборки для выполнения задачи сборки проекта. К счастью, нам не нужно беспокоиться об этом, а поручить нашей системе сборки учесть эти детали за нас.</p>
<p>Наконец, мы кратко напомним содержимое готового файла <code class="docutils literal notranslate"><span class="pre">CMakeLists.txt</span></code>, используемого для описания нашего проекта:</p>
<div class="highlight-cmake notranslate"><div class="highlight"><pre><span></span><span class="nb">cmake_minimum_required</span><span class="p">(</span><span class="s">VERSION</span><span class="w"> </span><span class="s">3.7</span><span class="p">)</span>
<span class="nb">project</span><span class="p">(</span><span class="s2">&quot;my_proj&quot;</span><span class="w"> </span><span class="s">LANGUAGES</span><span class="w"> </span><span class="s2">&quot;Fortran&quot;</span><span class="p">)</span>
<span class="nb">add_executable</span><span class="p">(</span><span class="s2">&quot;my_prog&quot;</span><span class="w"> </span><span class="s2">&quot;tabulate.f90&quot;</span><span class="w"> </span><span class="s2">&quot;functions.f90&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>Мы указали, что у нас есть проект на языке Fortran и сказали системе сборки CMake создать исполняемый файл <code class="docutils literal notranslate"><span class="pre">my_prog</span></code> на основе файлов исходного кода <code class="docutils literal notranslate"><span class="pre">tabulate.f90</span></code> и <code class="docutils literal notranslate"><span class="pre">functions.f90</span></code>. CMake знает, как собрать исполняемый файл из указанных исходных файлов, поэтому нам не нужно беспокоиться о фактически выполняемых шагах в процессе сборки.</p>
<div class="admonition tip">
<p class="admonition-title">Совет</p>
<p>CMake’s official reference can be found at the
<a href="https://cmake.org/cmake/help/latest/" target="_blank" rel="noopener">CMake webpage</a>.
It is organised in manpages, which are also available with your local CMake
installation as well using <code class="docutils literal notranslate"><span class="pre">man</span> <span class="pre">cmake</span></code>. While it covers all functionality of
CMake, it sometimes covers them only very briefly.</p>
</div>
</section>
</section>

<div class="section ablog__blog_comments">
  
  
</div>

              </article>
              

              
          </div>
          
      </div>
    </div>

  
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../../_static/scripts/pydata-sphinx-theme.js?digest=92025949c220c2e29695"></script>

<footer class="bd-footer"><div class="bd-footer__inner container">
  
  <div class="footer-item">
    <p class="copyright">
    &copy; Copyright 2020-2022, Fortran Community.<br>
</p>
  </div>
  
</div>
</footer>
  </body>
</html>