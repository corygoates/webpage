
<!DOCTYPE html>

<html lang="ru">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />
    <link rel="icon" sizes="256x256" href="../../../_static/images/favicon.ico" type="image/x-icon">
    <title>Управление библиотеками (статические и динамические библиотеки) &#8212; Fortran Programming Language</title>
<script>
  document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
  document.documentElement.dataset.theme = localStorage.getItem("theme") || "light"
</script>

  <!-- Loaded before other Sphinx assets -->
  <link href="../../../_static/styles/theme.css?digest=92025949c220c2e29695" rel="stylesheet">
<link href="../../../_static/styles/pydata-sphinx-theme.css?digest=92025949c220c2e29695" rel="stylesheet">


  <link rel="stylesheet"
    href="../../../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/design-style.1e8bd061cd6da7fc9cf755528e8ffc24.min.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/custom.css" />

  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../../_static/scripts/pydata-sphinx-theme.js?digest=92025949c220c2e29695">

    <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
    <script src="../../../_static/doctools.js"></script>
    <script src="../../../_static/sphinx_highlight.js"></script>
    <script src="../../../_static/clipboard.min.js"></script>
    <script src="../../../_static/copybutton.js"></script>
    <script src="../../../_static/translations.js"></script>
    <script src="../../../_static/design-tabs.js"></script>
    <link rel="canonical" href="https://fortran-lang.org/en/learn/building_programs/managing_libraries.html" />
    <link rel="index" title="Алфавитный указатель" href="../../../genindex/" />
    <link rel="search" title="Поиск" href="../../../search/" />
    <link rel="next" title="Инструменты сборки" href="../build_tools/" />
    <link rel="prev" title="Подключаемые файлы и модули" href="../include_files/" />

<meta
  name="description"
  content="Fortran : High-performance parallel programming language"
/>
<meta
  name="keywords"
  content="High-performance, parallel, programming language"
/>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
<script type="text/javascript">
  var pr_number = -1;
  $(document).ready(function () {
    if (window.location.href.indexOf("/pr/") > -1) {
      pr_number = window.location.href.split("/").indexOf("pr") + 1;
      document.getElementById("pr").innerHTML =
        "pull request " + window.location.href.split("/")[pr_number];
      document.getElementById("pr").href =
        "https://github.com/fortran-lang/webpage/pull/" +
        window.location.href.split("/")[pr_number];
      var banner = document.getElementById("banner");
      banner.style.display = "block";
    }
  });
</script>
<div id="banner" style="display: none" class="container">
  <h3>
    <svg
      xmlns="http://www.w3.org/2000/svg"
      width="24"
      height="24"
      viewBox="0 0 24 24"
      fill="none"
      stroke="currentColor"
      stroke-width="2"
      stroke-linecap="round"
      stroke-linejoin="round"
      class="feather feather-git-pull-request"
    >
      <circle cx="18" cy="18" r="3"></circle>
      <circle cx="6" cy="6" r="3"></circle>
      <path d="M13 6h3a2 2 0 0 1 2 2v7"></path>
      <line x1="6" y1="9" x2="6" y2="21"></line>
    </svg>
    <b>Site preview: </b>you are previewing unpublished changes for
    <a id="pr"></a>
  </h3>
</div>

<link
  rel="alternate"
  type="application/atom+xml"
  href="../../../news/atom.xml"
  title="Blog"
/>


<link href="True" rel="stylesheet"/>


  </head>
  
  
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="180" data-default-mode="">
    <div class="bd-header-announcement container-fluid" id="banner">
      

    </div>

    
    <nav class="bd-header navbar navbar-light navbar-expand-lg bg-light fixed-top bd-navbar" id="navbar-main"><div class="bd-header__inner container-xl">

  <div id="navbar-start">
    
    
  


<a class="navbar-brand logo" href="../../../">
  
  
  
  
  
    <p class="title logo__title">Fortran Programming Language</p>
  
</a>
    
    <span id="theme-switch" class="btn btn-sm btn-outline-primary navbar-btn rounded-circle">
    <a class="theme-switch" data-mode="light"><i class="fas fa-sun"></i></a>
    <a class="theme-switch" data-mode="dark"><i class="far fa-moon"></i></a>
    <a class="theme-switch" data-mode="auto"><i class="fas fa-adjust"></i></a>
</span>
    
    <div class="dropdown" id="version_switcher">
  <button
    type="button"
    class="btn btn-sm navbar-btn dropdown-toggle"
    id="version_switcher_button"
    data-toggle="dropdown"
  >
    ru
    <!-- this text may get changed later by javascript -->
    <span class="caret"></span>
  </button>
  <div
    id="version_switcher_menu"
    class="dropdown-menu list-group-flush py-0"
    aria-labelledby="version_switcher_button"
  >
    <!-- dropdown will be populated by javascript on page load -->
  </div>
</div>

<!-- NOTE: this JS must live here (not in our global JS file) because it relies
     on being processed by Jinja before it is run (specifically for replacing
     variables learn/building_programs/managing_libraries and {'json_url': 'https://fortran-lang.org/', 'version_match': 'ru'}.
-->

<script type="text/javascript">
  // Check if corresponding page path exists in other version of docs
  // and, if so, go there instead of the homepage of the other docs version
  function checkPageExistsAndRedirect(event) {
    const currentFilePath = "learn/building_programs/managing_libraries",
      tryUrl = event.target.getAttribute("href");
    location.href = tryUrl;
    // this prevents the browser from following the href of the clicked node
    // (which is fine because this function takes care of redirecting)
    return false;
  }

  // Populate the version switcher from the JSON config file
  (function () {
    const currentFilePath = "learn/building_programs/managing_libraries";
    const indexFilePath = "../../../";
    let btn = document.getElementById("version_switcher_button");
    // Set empty strings by default so that these attributes exist and can be used in CSS selectors
    btn.dataset["activeVersionName"] = "";
    btn.dataset["activeVersion"] = "";
    // create links to the corresponding page in the other docs versions
    data = [
      {
        name: "English",
        version: "en",
        url: "",
      },
      {
        name: "bn",
        version: "bn",
        url: "bn/",
      },
      {
        name: "cs",
        version: "cs",
        url: "cs/",
      },
      {
        name: "Deutsch",
        version: "de",
        url: "de/",
      },
      {
        name: "Español",
        version: "es",
        url: "es/",
      },
      {
        name: "Français",
        version: "fr",
        url: "fr/",
      },
      {
        name: "ja",
        version: "ja",
        url: "ja/",
      },
      {
        name: "Nederlands",
        version: "nl",
        url: "nl/",
      },
      {
        name: "pl",
        version: "pl",
        url: "pl/",
      },
      {
        name: "Português",
        version: "pt",
        url: "pt/",
      },
      {
        name: "Русский",
        version: "ru",
        url: "ru/",
      },
      {
        name: "简体中文",
        version: "zh_CN",
        url: "zh_CN/",
      },
    ];
    // console.log(data);
    $.each(data, function (index, entry) {
      // if no custom name specified (e.g., "latest"), use version string
      if (!("name" in entry)) {
        entry.name = entry.version;
      }
      // create the node
      const node = document.createElement("a");
      node.setAttribute("class", "list-group-item list-group-item-action py-1");
      node.textContent = `${entry.name}`;


      node.setAttribute(
        "href",
        `https://fortran-lang.org/${entry.url}${currentFilePath}`,
      );

      // on click, AJAX calls will check if the linked page exists before
      // trying to redirect, and if not, will redirect to the homepage
      // for that version of the docs.
      node.onclick = checkPageExistsAndRedirect;
      // Add dataset values for the version and name in case people want
      // to apply CSS styling based on this information.
      node.dataset["versionName"] = entry.name;
      node.dataset["version"] = entry.version;

      $("#version_switcher_menu").append(node);
      // replace dropdown button text with the preferred display name of
      // this version, rather than using sphinx's  variable.
      // also highlight the dropdown entry for the currently-viewed
      // version's entry
      if (entry.version == "ru") {
        node.classList.add("active");
        btn.innerText = btn.dataset["activeVersionName"] = entry.name;
        btn.dataset["activeVersion"] = entry.version;
      }
    });
  })();
</script>
    
  </div>

  <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-collapsible" aria-controls="navbar-collapsible" aria-expanded="false" aria-label="Toggle navigation">
    <span class="fas fa-bars"></span>
  </button>

  
  <div id="navbar-collapsible" class=" collapse navbar-collapse">
    <div id="navbar-center" class="ml-auto">
      
      <div class="navbar-center-item">
        <ul id="navbar-main-elements" class="navbar-nav">
    <li class="toctree-l1 nav-item">
 <a class="reference external nav-link" href="https://play.fortran-lang.org/">
  Play
 </a>
</li>

<li class="toctree-l1 current active nav-item">
 <a class="reference internal nav-link" href="../../">
  Обучение
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../../../roadmap/">
  Roadmap
  <!-- omit in toc -->
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../../../compilers/">
  Компиляторы
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../../../community/">
  Community
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../../../packages/">
  Packages
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../../../news/">
  News
 </a>
</li>

    
</ul>
      </div>
      
    </div>

    <div id="navbar-end">
      
      <div class="navbar-end-item">
        <ul id="navbar-icon-links" class="navbar-nav" aria-label="Icon Links">
        <li class="nav-item">
          <a class="nav-link" href="https://fortran-lang.discourse.group/" rel="noopener" target="_blank" title="Discourse"><span><i class="fab fa-discourse"></i></span>
            <label class="sr-only">Discourse</label></a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="https://twitter.com/fortranlang" rel="noopener" target="_blank" title="Twitter"><span><i class="fab fa-twitter"></i></span>
            <label class="sr-only">Twitter</label></a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="https://github.com/fortran-lang" rel="noopener" target="_blank" title="GitHub"><span><i class="fab fa-github"></i></span>
            <label class="sr-only">GitHub</label></a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="https://fortran-lang.org/en/news/atom.xml" rel="noopener" target="_blank" title="RSS"><span><i class="fas fa-rss"></i></span>
            <label class="sr-only">RSS</label></a>
        </li>
      </ul>
      </div>
      
      <div class="navbar-end-item">
        <form class="bd-search d-flex align-items-center" action="../../../search/" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Поиск" aria-label="Search" autocomplete="off" >
</form>
      </div>
      
    </div>
  </div>
</div>
    </nav>
    

    <div class="bd-container container-xl">
      <div class="bd-container__inner row">
          

<!-- Only show if we have sidebars configured, else just a small margin  -->
<div class="bd-sidebar-primary col-12 col-md-3 bd-sidebar">
  <div class="sidebar-start-items"><nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
  <div class="bd-toc-item active">
    <ul class="current nav bd-sidenav">
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../../os_setup/">
   Настройка вашей ОС
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../../os_setup/choose_compiler/">
     Выбор компилятора
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../os_setup/install_gfortran/">
     Установка GFortran
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../os_setup/text_editors/">
     Текстовые редакторы
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../os_setup/ides/">
     IDE (Интегрированная среда разработки)
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../os_setup/tips/">
     Полезные советы
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../../quickstart/">
   Краткое руководство
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/>
  <label for="toctree-checkbox-2">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../../quickstart/hello_world/">
     Hello world
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../quickstart/variables/">
     Переменные
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../quickstart/arrays_strings/">
     Массивы и строки
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../quickstart/operators_control_flow/">
     Операторы и поток управления
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../quickstart/organising_code/">
     Организация структуры кода
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../quickstart/derived_types/">
     Производные типы данных
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 current active has-children">
  <a class="reference internal" href="../">
   Сборка программ
  </a>
  <input checked="" class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/>
  <label for="toctree-checkbox-3">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul class="current">
   <li class="toctree-l2">
    <a class="reference internal" href="../compiling_source/">
     Компиляция исходного кода
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../linking_pieces/">
     Компоновка объектов
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../runtime_libraries/">
     Библиотеки времени выполнения
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../include_files/">
     Подключаемые файлы и модули
    </a>
   </li>
   <li class="toctree-l2 current active">
    <a class="current reference internal" href="#">
     Управление библиотеками (статические и динамические библиотеки)
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../build_tools/">
     Инструменты сборки
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../project_make/">
     Введение в систему сборки make
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../distributing/">
     Распространение ваших программ
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../../best_practices/">
   Практические рекомендации по разработке на Fortran
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/>
  <label for="toctree-checkbox-4">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../../best_practices/style_guide/">
     Руководство по стилю оформления кода Fortran
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../best_practices/floating_point/">
     Числа с плавающей точкой
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../best_practices/integer_division/">
     Целочисленное деление
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../best_practices/modules_programs/">
     Модули и программы
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../best_practices/arrays/">
     Массивы
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../best_practices/multidim_arrays/">
     Многомерные массивы
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../best_practices/element_operations/">
     Элементные операции с массивами
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../best_practices/allocatable_arrays/">
     Выделяемые (динамические) массивы
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../best_practices/file_io/">
     Файловый ввод/вывод
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../best_practices/callbacks/">
     Функции обратного вызова
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../best_practices/type_casting/">
     Приведение типа в функциях обратного вызова
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../../intrinsics/">
   Fortran Intrinsics
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" type="checkbox"/>
  <label for="toctree-checkbox-5">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../../intrinsics/array/">
     Properties and attributes of arrays
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../intrinsics/bit/">
     Bit-level inquiry and manipulation
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../intrinsics/character/">
     Basic procedures for manipulating
     <em>
      character
     </em>
     variables
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../intrinsics/compiler/">
     Information about compiler and compiler options used for building
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../intrinsics/cfi/">
     Procedures for binding to C interfaces
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../intrinsics/math/">
     General mathematical functions
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../intrinsics/model/">
     Controlling and querying the current numeric model
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../intrinsics/numeric/">
     Manipulation and properties of numeric values
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../intrinsics/parallel/">
     Parallel programming using co_arrays and co_indexed arrays
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../intrinsics/state/">
     General and miscellaneous intrinsics
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../intrinsics/system/">
     Accessing external system information
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../intrinsics/transform/">
     Matrix multiplication, dot product, and array shifts
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../intrinsics/type/">
     Types and kinds
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference external" href="https://www.gnu.org/licenses/old-licenses/fdl-1.2.en.html">
     GNU Free Documentation License
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../rosetta_stone/">
   Python Fortran Rosetta Stone
  </a>
 </li>
</ul>

  </div>
</nav>
  </div>
  <div class="sidebar-end-items">
  </div>
</div>


          


<div class="bd-sidebar-secondary d-none d-xl-block col-xl-2 bd-toc">
  
    
    <div class="toc-item">
        
<br />

<div class="tocsection onthispage">
  <i class="fas fa-list"></i> On this page
</div>

<nav id="bd-toc-nav" class="page-toc"><ul class="nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#static-versus-dynamic-libraries">
   Статические библиотеки в сравнении с динамическими
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#gnu-linux-and-gfortran">
   GNU/Linux и gfortran
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#windows-and-intel-fortran">
   Windows и Intel Fortran
  </a>
 </li>
</ul>
</nav> 
    </div>
    
  
</div>


          
          
          <div class="bd-content col-12 col-md-9 col-xl-7">
              
              <article class="bd-article" role="main">
                
<section class="tex2jax_ignore mathjax_ignore" id="managing-libraries-static-and-dynamic-libraries">
<h1>Управление библиотеками (статические и динамические библиотеки)<a class="headerlink" href="#managing-libraries-static-and-dynamic-libraries" title="Permalink to this heading">#</a></h1>
<p>Если вам нужно управлять программой, собранной из десятков файлов исходного кода (а это не редкость!), то командная строка, необходимая для указания всех объектных файлов будет очень длинной. Очень скоро поддержка такого списка станет утомительной или даже невозможной. Поэтому необходимо другое решение: создание собственных библиотек.</p>
<p>Библиотеки содержат любое количество объектных файлов в компактной форме, так что командная строка для сборки программы становится короче:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>gfortran<span class="w"> </span>-o<span class="w"> </span>tabulate<span class="w"> </span>tabulate.f90<span class="w"> </span>functions.o<span class="w"> </span>supportlib.a
</pre></div>
</div>
<p>где «supportlib.a» – набор из одного, двух или нескольких объектных файлов, скомпилированных, а затем помещённых в библиотеку. Расширение файла «.a» используется в операционных системах Linux и Linux-подобных платформах. В операционной системе Windows используется расширение «.lib».</p>
<p>Создание собственных библиотек не так уж сложно: в Linux это можно сделать, например, с помощью утилиты <code class="docutils literal notranslate"><span class="pre">ar</span></code>:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>gfortran<span class="w"> </span>-c<span class="w"> </span>file1.f90<span class="w"> </span>file2.f90
$<span class="w"> </span>gfortran<span class="w"> </span>-c<span class="w"> </span>file3.f90<span class="w"> </span>...
$<span class="w"> </span>ar<span class="w"> </span>r<span class="w"> </span>supportlib.a<span class="w"> </span>file1.o<span class="w"> </span>file2.o
$<span class="w"> </span>ar<span class="w"> </span>r<span class="w"> </span>supportlib.a<span class="w"> </span>file3.o<span class="w"> </span>...
</pre></div>
</div>
<p>а в Windows с помощью утилиты <code class="docutils literal notranslate"><span class="pre">lib</span></code>:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>c:<span class="se">\.</span>..&gt;<span class="w"> </span>ifort<span class="w"> </span>-c<span class="w"> </span>file1.f90<span class="w"> </span>file2.f90
c:<span class="se">\.</span>..&gt;<span class="w"> </span>ifort<span class="w"> </span>-c<span class="w"> </span>file3.f90<span class="w"> </span>...
c:<span class="se">\.</span>..&gt;<span class="w"> </span>lib<span class="w"> </span>/out:supportlib.lib<span class="w"> </span>file1.obj<span class="w"> </span>file2.obj
c:<span class="se">\.</span>..&gt;<span class="w"> </span>lib<span class="w"> </span>supportlib.lib<span class="w"> </span>file3.obj<span class="w"> </span>...
</pre></div>
</div>
<p>Примечание:</p>
<ul class="simple">
<li><p>Команда <code class="docutils literal notranslate"><span class="pre">ar</span></code> с опцией <code class="docutils literal notranslate"><span class="pre">r</span></code> либо создаёт библиотеку (имя указывается после опции), либо добавляет в библиотеку новые объектные файлы (или заменяет все существующие).</p></li>
<li><p>Команда <code class="docutils literal notranslate"><span class="pre">lib</span></code> создаёт новую библиотеку, если указать опцию <code class="docutils literal notranslate"><span class="pre">/out:</span></code> с именем новой библиотеки следом за ней. Чтобы добавить объектные файлы к существующей библиотеке, опустите опцию <code class="docutils literal notranslate"><span class="pre">/out:</span></code>.</p></li>
<li><p>На таких платформах как Linux, существует определённое соглашение об именовании библиотек. Если вы назовёте свою библиотеку как «libname.a» (обратите внимание на префикс «lib»), тогда на этапе компоновки вы сможете ссылаться на неё как на <code class="docutils literal notranslate"><span class="pre">-lname</span></code>.</p></li>
<li><p>Библиотеки часто ищутся в каталогах, указанных с помощью опции компилятора <code class="docutils literal notranslate"><span class="pre">-L</span></code> или <code class="docutils literal notranslate"><span class="pre">/LIBPATH</span></code>. Это избавляет вас от необходимости указывать точный путь для каждой библиотеки.</p></li>
</ul>
<p>Используя библиотеки, вы можете создавать очень большие программы, не прибегая к чрезвычайно длинным командным строкам для описания процесса сборки.</p>
<section id="static-versus-dynamic-libraries">
<h2>Статические библиотеки в сравнении с динамическими<a class="headerlink" href="#static-versus-dynamic-libraries" title="Permalink to this heading">#</a></h2>
<p>Приведённые выше рассуждения негласно предполагают, что вы используете так называемые статические библиотеки. Статические библиотеки (или, по крайней мере, часть их содержимого) становятся неотъемлемой частью исполняемого файла программы. Единственный способ изменить встроенные в программу подпрограммы – это пересобрать программу с новой версией библиотеки.</p>
<p>Гибкой альтернативой является использование так называемых динамических библиотек. Эти библиотеки остаются снаружи исполняемого файла программы и, как следствие, могут быть заменены без пересборки всей программы. Компиляторы и сама операционная система в значительной степени полагаются на такие динамические библиотеки. Можно рассматривать динамические библиотеки как своего рода исполняемые программы, которым для запуска требуется небольшая помощь.</p>
<p>Создание динамических библиотек происходит немного иначе, чем создание статических: вы используете компилятор/компоновщик вместо таких инструментов как <code class="docutils literal notranslate"><span class="pre">ar</span></code> или <code class="docutils literal notranslate"><span class="pre">lib</span></code>.</p>
<p>В Linux:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>gfortran<span class="w"> </span>-fpic<span class="w"> </span>-c<span class="w"> </span>file1.f90<span class="w"> </span>file2.f90
$<span class="w"> </span>gfortran<span class="w"> </span>-fpic<span class="w"> </span>-c<span class="w"> </span>file3.f90<span class="w"> </span>...
$<span class="w"> </span>gfortran<span class="w"> </span>-shared<span class="w"> </span>-o<span class="w"> </span>supportlib.so<span class="w"> </span>file1.o<span class="w"> </span>file2.o<span class="w"> </span>file3.o<span class="w"> </span>...
</pre></div>
</div>
<p>В Windows с компилятором Intel Fortran:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>ifort<span class="w"> </span>-c<span class="w"> </span>file1.f90<span class="w"> </span>file2.f90
$<span class="w"> </span>ifort<span class="w"> </span>-c<span class="w"> </span>file3.f90<span class="w"> </span>...
$<span class="w"> </span>ifort<span class="w"> </span>-dll<span class="w"> </span>-exe:supportlib.dll<span class="w"> </span>file1.obj<span class="w"> </span>file2.obj<span class="w"> </span>file3.obj<span class="w"> </span>...
</pre></div>
</div>
<p>Различия заключаются в следующем:</p>
<ul class="simple">
<li><p>В Linux вам необходимо указать опцию компиляции, для gfortran это <code class="docutils literal notranslate"><span class="pre">-fpic</span></code>, поскольку объектный код немного отличается.</p></li>
<li><p>На этапе компоновки нужно указать, что вам нужна динамическая библиотека (в Linux: shared object/library, отсюда расширение «.so»; в Windows: dynamic link library)</p></li>
</ul>
<p>Есть ещё один момент, о котором следует знать: в Windows вы должны явно указать, что процедура должна быть <em>экспортирована</em>, т.е. видна в динамической библиотеке. Существует несколько способов, в зависимости от используемого компилятора, добиться этого. Один из них – с помощью так называемой директивы компилятора:</p>
<div class="highlight-fortran notranslate"><div class="highlight"><pre><span></span><span class="k">subroutine </span><span class="n">myroutine</span><span class="p">(</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="p">)</span>
<span class="c">!GCC$ ATTRIBUTES DLLEXPORT:: myroutine</span>
</pre></div>
</div>
<p>Или, при использовании компилятора Intel Fortran:</p>
<div class="highlight-fortran notranslate"><div class="highlight"><pre><span></span><span class="k">subroutine </span><span class="n">myroutine</span><span class="p">(</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="p">)</span>
<span class="c">!DEC$ ATTRIBUTES DLLEXPORT:: myroutine</span>
</pre></div>
</div>
<p>Кроме динамической библиотеки (DLL), может быть сгенерирована так называемая импортируемая библиотека (import library).</p>
<p>Поскольку детали отличаются в зависимости от компилятора, приведём два примера: gfortran в оболочке Cygwin и Intel Fortran в Windows. В обоих случаях мы рассматриваем программу <code class="docutils literal notranslate"><span class="pre">tabulate</span></code> из файла «tabulate.f90».</p>
</section>
<section id="gnu-linux-and-gfortran">
<h2>GNU/Linux и gfortran<a class="headerlink" href="#gnu-linux-and-gfortran" title="Permalink to this heading">#</a></h2>
<p>Для программы <code class="docutils literal notranslate"><span class="pre">tabulate</span></code> требуется пользовательская подпрограмма <code class="docutils literal notranslate"><span class="pre">f</span></code>. Если мы поместим её в динамическую библиотеку, например, «functions.dll», мы можем просто заменить реализацию функции, поместив в каталог другую динамическую библиотеку. Пересобирать саму программу при этом не нужно.</p>
<p>В оболочке Cygwin нет необходимости явно экспортировать подпрограмму – все публично видимые подпрограммы экспортируются при создании динамической библиотеки. При этом не создаётся импортируемая библиотека.</p>
<p>Так как наша динамическая библиотека может быть собрана из одного файла исходного кода, мы можем использовать простой способ её создания:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>gfortran<span class="w"> </span>-shared<span class="w"> </span>-o<span class="w"> </span>functions.dll<span class="w"> </span>functions.f90
</pre></div>
</div>
<p>В результате будут созданы файлы «functions.dll» и «user_functions.mod». Утилита <code class="docutils literal notranslate"><span class="pre">nm</span></code> сообщает нам точное имя функции <code class="docutils literal notranslate"><span class="pre">f</span></code>:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>nm<span class="w"> </span>functions.dll
...
000000054f9d7000<span class="w"> </span>B<span class="w"> </span>__dynamically_loaded
<span class="w">                 </span>U<span class="w"> </span>__end__
<span class="m">0000000000000200</span><span class="w"> </span>A<span class="w"> </span>__file_alignment__
000000054f9d1030<span class="w"> </span>T<span class="w"> </span>__function_MOD_f
000000054f9d1020<span class="w"> </span>T<span class="w"> </span>__gcc_deregister_frame
000000054f9d1000<span class="w"> </span>T<span class="w"> </span>__gcc_register_frame
...
</pre></div>
</div>
<p>Она получила префикс <code class="docutils literal notranslate"><span class="pre">__function_MOD_</span></code>, чтобы можно было отличить её от функции «f», которая может быть определена в другом модуле.</p>
<p>Следующим шагом будет сборка программы:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>gfortran<span class="w"> </span>-o<span class="w"> </span>tabulate<span class="w"> </span>tabulate.f90<span class="w"> </span>functions.dll
</pre></div>
</div>
<p>DLL и файл .mod используются для сборки исполняемого файла программы с проверкой интерфейса функции, правильного имени и ссылки на DLL, названой «functions.dll».</p>
<p>Вы можете заменить разделяемую библиотеку «functions.dll» на другую, реализующую другую функцию «f». Конечно, нужно быть осторожным, чтобы использовать правильный интерфейс для этой функции. Компилятор и компоновщик не вызываются повторно, поэтому они не могут сделать никаких проверок.</p>
</section>
<section id="windows-and-intel-fortran">
<h2>Windows и Intel Fortran<a class="headerlink" href="#windows-and-intel-fortran" title="Permalink to this heading">#</a></h2>
<p>Настройка в этом случае такая же, как и в случае с Linux, но в Windows необходимо явно экспортировать подпрограммы. При этом создаётся импортируемая библиотека (import library) – именно эта библиотека должна использоваться на этапе компоновки.</p>
<p>Файл исходного кода должен содержать директиву компилятора, иначе функция <code class="docutils literal notranslate"><span class="pre">f</span></code> не будет экспортирована:</p>
<div class="highlight-fortran notranslate"><div class="highlight"><pre><span></span><span class="kt">real </span><span class="k">function </span><span class="n">f</span><span class="p">(</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="p">)</span>
<span class="c">!DEC$ ATTRIBUTES DLLEXPORT :: f</span>
</pre></div>
</div>
<p>И снова мы используем простой способ сборки библиотеки:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>ifort<span class="w"> </span>-exe:functions.dll<span class="w"> </span>functions.f90<span class="w"> </span>-dll
</pre></div>
</div>
<p>В результате также будет созданы файлы «functions.dll», «user_functions.mod», а также «functions.lib» (и ещё два файла, не имеющие в данном случае значения). Программа «dependency walker» сообщит нам, что точное имя функции «f» – <code class="docutils literal notranslate"><span class="pre">FUNCTION_mp_F</span></code>. Она также экспортирована, чтобы компоновщик смог найти её на следующем этапе сборки программы:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ ifort tabulate.f90 functions.lib
</pre></div>
</div>
<p>Обратите внимание, что нам нужно указать имя экспортируемой библиотеки, а не DLL!</p>
<p>(Отметим также: компилятор Intel Fortran использует имя первого файла исходного файла в качестве имени исполняемого файла программы – здесь мы обходимся без использования опции <code class="docutils literal notranslate"><span class="pre">-exe</span></code>.)</p>
<p>Как и в оболочке Cygwin, файлы DLL и .mod используются для сборки исполняемого файла программы с проверкой интерфейса функции, правильного имени и ссылки на DLL, названную «functions.dll».</p>
<p>Вы можете заменить разделяемую библиотеку «functions.dll» другой, но при этом необходимо соблюдать ту же осторожность: хотя реализация может быть совершенно другой, интерфейс функции должен быть тем же самым.</p>
</section>
</section>

<div class="section ablog__blog_comments">
  
  
</div>

              </article>
              

              
          </div>
          
      </div>
    </div>

  
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../../_static/scripts/pydata-sphinx-theme.js?digest=92025949c220c2e29695"></script>

<footer class="bd-footer"><div class="bd-footer__inner container">
  
  <div class="footer-item">
    <p class="copyright">
    &copy; Copyright 2020-2022, Fortran Community.<br>
</p>
  </div>
  
</div>
</footer>
  </body>
</html>